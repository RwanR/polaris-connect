<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRIEF TECHNIQUE - Connecteur Polaris ERP ‚Üî Shopify</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
            margin-top: 30px;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #95a5a6;
            padding-bottom: 8px;
            margin-top: 25px;
        }
        h3 {
            color: #16a085;
            margin-top: 20px;
        }
        h4 {
            color: #27ae60;
            margin-top: 15px;
        }
        h5 {
            color: #8e44ad;
            margin-top: 12px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 15px 0;
            box-shadow: 0 2px 3px rgba(0,0,0,0.1);
        }
        th {
            background-color: #3498db;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }
        td {
            padding: 10px;
            border: 1px solid #ddd;
        }
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        tr:hover {
            background-color: #e8f4f8;
        }
        pre {
            background-color: #f4f4f4;
            border: 1px solid #ddd;
            border-left: 4px solid #3498db;
            padding: 15px;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
            line-height: 1.4;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 14px;
        }
        .highlight {
            background-color: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        .success {
            background-color: #d4edda;
            padding: 15px;
            border-left: 4px solid #28a745;
            margin: 15px 0;
        }
        .warning {
            background-color: #fff3cd;
            padding: 15px;
            border-left: 4px solid #ffc107;
            margin: 15px 0;
        }
        .danger {
            background-color: #f8d7da;
            padding: 15px;
            border-left: 4px solid #dc3545;
            margin: 15px 0;
        }
        .info {
            background-color: #d1ecf1;
            padding: 15px;
            border-left: 4px solid #17a2b8;
            margin: 15px 0;
        }
        ul, ol {
            margin: 10px 0;
            padding-left: 30px;
        }
        li {
            margin: 5px 0;
        }
        strong {
            color: #2c3e50;
        }
        .architecture-diagram {
            background-color: #f8f9fa;
            padding: 20px;
            border: 2px solid #dee2e6;
            margin: 20px 0;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre;
            overflow-x: auto;
        }
        .page-break {
            page-break-after: always;
        }
        @media print {
            body {
                padding: 0;
            }
            .page-break {
                page-break-after: always;
            }
        }
    </style>
</head>
<body>

<h1>BRIEF TECHNIQUE - Connecteur Polaris ERP ‚Üî Shopify</h1>

<div class="success">
    <h2>üìã R√âSUM√â EX√âCUTIF</h2>
    <p><strong>OUI, cette application est bien un connecteur bidirectionnel entre l'ERP Polaris et Shopify.</strong></p>
    <p>Elle synchronise :</p>
    <ul>
        <li><strong>Polaris ‚Üí Shopify</strong> : Produits, prix, stocks multi-magasins</li>
        <li><strong>Shopify ‚Üí Polaris</strong> : Commandes clients</li>
    </ul>
    <p><strong>OUI, ce code peut servir de base pour recr√©er un connecteur Polaris-Shopify pour votre client vendeur de chaussures.</strong></p>
</div>

<h2>üéØ OBJECTIF DE L'APPLICATION</h2>

<p>Cette application nomm√©e "Owlblack Connector ERP" est un <strong>middleware de synchronisation</strong> qui :</p>

<ol>
    <li><strong>Import des produits</strong> : R√©cup√®re les produits depuis l'API Polaris et les cr√©e/met √† jour dans Shopify</li>
    <li><strong>Gestion des stocks multi-magasins</strong> : Synchronise les stocks disponibles pour chaque point de vente</li>
    <li><strong>Gestion des prix</strong> : Prix TTC et prix comparatif (prix barr√©)</li>
    <li><strong>Envoi des commandes</strong> : Transmet les commandes Shopify vers l'ERP Polaris en temps r√©el via webhooks</li>
    <li><strong>Suppression en cascade</strong> : G√®re la suppression de produits</li>
</ol>

<h2>üèóÔ∏è ARCHITECTURE GLOBALE</h2>

<div class="architecture-diagram">
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   ERP POLARIS   ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ  CONNECTEUR NODE.JS  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ    SHOPIFY      ‚îÇ
‚îÇ                 ‚îÇ  HTTPS  ‚îÇ                      ‚îÇ  GraphQL‚îÇ                 ‚îÇ
‚îÇ  - Produits     ‚îÇ         ‚îÇ  - Express API       ‚îÇ         ‚îÇ  - Products     ‚îÇ
‚îÇ  - Stocks       ‚îÇ         ‚îÇ  - PostgreSQL        ‚îÇ         ‚îÇ  - Variants     ‚îÇ
‚îÇ  - Ventes       ‚îÇ         ‚îÇ  - Sync Scripts      ‚îÇ         ‚îÇ  - Inventory    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ  - Webhooks          ‚îÇ         ‚îÇ  - Orders       ‚îÇ
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                      ‚îÇ
                                      ‚ñº
                            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                            ‚îÇ   PostgreSQL DB      ‚îÇ
                            ‚îÇ                      ‚îÇ
                            ‚îÇ  - products          ‚îÇ
                            ‚îÇ  - variant_options   ‚îÇ
                            ‚îÇ  - stock_by_store    ‚îÇ
                            ‚îÇ  - shopify_orders    ‚îÇ
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</div>

<div class="page-break"></div>

<h2>üìÇ STRUCTURE DES FICHIERS ET RESPONSABILIT√âS</h2>

<h3>üîπ /api - Serveur API Express</h3>

<h4>/api/index.js - Point d'entr√©e principal</h4>
<ul>
    <li>D√©marre le serveur Express sur le port 3000</li>
    <li>Configure middleware (morgan pour logs, express.raw pour webhooks)</li>
    <li>Route <code>/webhook</code> ‚Üí shopifyRoutes</li>
</ul>

<h4>/api/routes/shopify.js - Routes webhooks Shopify</h4>
<p><strong>3 endpoints principaux :</strong></p>

<table>
    <thead>
        <tr>
            <th>Endpoint</th>
            <th>M√©thode</th>
            <th>Trigger Shopify</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>/webhook/products/delete</code></td>
            <td>POST</td>
            <td>Product deletion</td>
            <td>Supprime produit + variants + stocks en cascade</td>
        </tr>
        <tr>
            <td><code>/webhook/orders/create</code></td>
            <td>POST</td>
            <td>Order created</td>
            <td>R√©cup√®re le code magasin et envoie la commande √† l'ERP</td>
        </tr>
        <tr>
            <td><code>/webhook/orders/delete</code></td>
            <td>POST</td>
            <td>Order cancelled</td>
            <td>Marque la commande comme supprim√©e en BDD</td>
        </tr>
    </tbody>
</table>

<p><strong>Flux de cr√©ation de commande :</strong></p>
<ol>
    <li>V√©rifie signature HMAC Shopify</li>
    <li>V√©rifie si commande d√©j√† envoy√©e (√©vite les doublons)</li>
    <li>R√©cup√®re le <code>code_magasin</code> depuis les metafields de location</li>
    <li>Transforme les donn√©es Shopify ‚Üí format ERP</li>
    <li>Envoie √† l'API Polaris <code>/Ventes/Vente</code></li>
    <li>Enregistre en BDD avec statut "Envoy√©"</li>
</ol>

<h4>/api/services/erpService.js - Service d'envoi des commandes vers Polaris</h4>

<p><strong>M√©thode principale : <code>sendOrderToERP(codeMagasin, orderData)</code></strong></p>

<p><strong>Endpoint Polaris utilis√© :</strong></p>
<pre>POST {ERP_URL}/Ventes/Vente
Headers: X-API-Key</pre>

<p><strong>Structure du payload envoy√© √† Polaris :</strong></p>
<pre>{
  RefExt: "1234",                    // Num√©ro commande Shopify
  TypeVenteInternet: "Site",
  Client: {
    Nom: "Dupont",
    Prenom: "Jean",
    Telephone: { Numero: "" },
    Mobile: { Numero: "" },
    Adresse: {
      Nom: "Jean Dupont",
      Adresse1: "123 rue Example",
      CodePostal: "75001",
      Ville: "Paris",
      CodePays: "FR"
    },
    Mail: "jean@example.com",
    RefsExt: ["1234"]
  },
  CodeMagasin: "101",               // Code du magasin
  DateVente: "2025-11-16T10:00:00Z",
  Details: [
    {
      SKU: "REF-123-40",
      Qte: 2,
      MontantTTC: 89.90,
      RemiseTTC: 0,
      TypeRemise: "Normal"
    }
  ],
  Reglements: [
    {
      Code: "CC",                   // Carte de cr√©dit
      Montant: 179.80
    }
  ]
}</pre>

<div class="page-break"></div>

<h2>üóÑÔ∏è SCH√âMA DE BASE DE DONN√âES PostgreSQL</h2>

<h3>Table : products</h3>
<table>
    <thead>
        <tr>
            <th>Colonne</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>id</td>
            <td>SERIAL PRIMARY KEY</td>
            <td>ID auto-incr√©ment√©</td>
        </tr>
        <tr>
            <td>no_modele</td>
            <td>INTEGER UNIQUE</td>
            <td>Num√©ro de mod√®le Polaris (cl√© unique)</td>
        </tr>
        <tr>
            <td>shopify_product_id</td>
            <td>TEXT</td>
            <td>ID produit Shopify (gid://shopify/Product/xxx)</td>
        </tr>
        <tr>
            <td>title</td>
            <td>TEXT</td>
            <td>Titre du produit</td>
        </tr>
        <tr>
            <td>vendor</td>
            <td>TEXT</td>
            <td>Marque (ex: "Nike")</td>
        </tr>
        <tr>
            <td>product_type</td>
            <td>TEXT</td>
            <td>Type de produit (ex: "Chaussures Sport")</td>
        </tr>
        <tr>
            <td>erp_last_change</td>
            <td>TEXT</td>
            <td>Date derni√®re modification ERP</td>
        </tr>
        <tr>
            <td>to_send_to_shopify</td>
            <td>BOOLEAN</td>
            <td>Flag de synchronisation vers Shopify</td>
        </tr>
    </tbody>
</table>

<h3>Table : variant_options</h3>
<table>
    <thead>
        <tr>
            <th>Colonne</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>id</td>
            <td>SERIAL PRIMARY KEY</td>
            <td>ID auto-incr√©ment√©</td>
        </tr>
        <tr>
            <td>no_modele</td>
            <td>INTEGER</td>
            <td>R√©f√©rence au produit</td>
        </tr>
        <tr>
            <td>sku</td>
            <td>TEXT UNIQUE</td>
            <td>SKU unique (ex: "REF-12345-40")</td>
        </tr>
        <tr>
            <td>size</td>
            <td>TEXT</td>
            <td>Taille (ex: "40")</td>
        </tr>
        <tr>
            <td>color</td>
            <td>TEXT</td>
            <td>Couleur (ex: "Noir")</td>
        </tr>
        <tr>
            <td>price</td>
            <td>NUMERIC(10,2)</td>
            <td>Prix TTC</td>
        </tr>
        <tr>
            <td>compare_at_price</td>
            <td>NUMERIC(10,2)</td>
            <td>Prix normal TTC (prix barr√©)</td>
        </tr>
    </tbody>
</table>

<h3>Table : stock_by_store</h3>
<table>
    <thead>
        <tr>
            <th>Colonne</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>id</td>
            <td>SERIAL PRIMARY KEY</td>
            <td>ID auto-incr√©ment√©</td>
        </tr>
        <tr>
            <td>sku</td>
            <td>TEXT</td>
            <td>R√©f√©rence au variant</td>
        </tr>
        <tr>
            <td>code_magasin</td>
            <td>INTEGER</td>
            <td>Code du magasin Polaris</td>
        </tr>
        <tr>
            <td>dispo</td>
            <td>INTEGER</td>
            <td>Stock disponible</td>
        </tr>
    </tbody>
</table>

<h3>Table : shopify_orders</h3>
<table>
    <thead>
        <tr>
            <th>Colonne</th>
            <th>Type</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>order_id</td>
            <td>BIGINT PRIMARY KEY</td>
            <td>ID commande Shopify</td>
        </tr>
        <tr>
            <td>status</td>
            <td>TEXT</td>
            <td>Statut ("En cours", "Envoy√©", "Supprim√©")</td>
        </tr>
    </tbody>
</table>

<p><strong>Usage :</strong> √âviter les doublons d'envoi de commandes vers l'ERP.</p>

<div class="page-break"></div>

<h2>üîå ENDPOINTS API</h2>

<h3>Endpoints Polaris ERP utilis√©s</h3>

<table>
    <thead>
        <tr>
            <th>Endpoint</th>
            <th>M√©thode</th>
            <th>Usage</th>
            <th>Fichier</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>/Catalog/Produits</code></td>
            <td>GET</td>
            <td>R√©cup√©ration produits avec pagination</td>
            <td>/lib/erpClient/products.js</td>
        </tr>
        <tr>
            <td><code>/Ventes/Vente</code></td>
            <td>POST</td>
            <td>Cr√©ation d'une vente (commande)</td>
            <td>/api/services/erpService.js</td>
        </tr>
    </tbody>
</table>

<p><strong>Configuration :</strong></p>
<ul>
    <li>Base URL : <code>process.env.ERP_URL</code></li>
    <li>Authentification : Header <code>X-API-Key: {ERP_API_KEY}</code></li>
    <li>HTTPS : <code>rejectUnauthorized: false</code> (certificat auto-sign√© accept√©)</li>
</ul>

<h3>Endpoints Shopify GraphQL utilis√©s</h3>

<table>
    <thead>
        <tr>
            <th>Endpoint</th>
            <th>Type</th>
            <th>Usage</th>
            <th>Fichier</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>productSet</code></td>
            <td>Mutation</td>
            <td>Cr√©ation/mise √† jour produit + variants</td>
            <td>/lib/syncLogic/products.js</td>
        </tr>
        <tr>
            <td><code>locations</code></td>
            <td>Query</td>
            <td>R√©cup√©ration locations + metafields</td>
            <td>/lib/syncLogic/products.js</td>
        </tr>
        <tr>
            <td><code>order.fulfillmentOrders</code></td>
            <td>Query</td>
            <td>R√©cup√©ration location assign√©e commande</td>
            <td>/lib/syncLogic/products.js</td>
        </tr>
    </tbody>
</table>

<h3>Webhooks Shopify configur√©s</h3>

<table>
    <thead>
        <tr>
            <th>Topic</th>
            <th>URL</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><code>products/delete</code></td>
            <td>https://{VPS_URL}/webhook/products/delete</td>
            <td>Suppression cascade</td>
        </tr>
        <tr>
            <td><code>orders/create</code></td>
            <td>https://{VPS_URL}/webhook/orders/create</td>
            <td>Envoi commande vers ERP</td>
        </tr>
        <tr>
            <td><code>orders/delete</code></td>
            <td>https://{VPS_URL}/webhook/orders/delete</td>
            <td>Marquage suppression</td>
        </tr>
    </tbody>
</table>

<div class="page-break"></div>

<h2>‚öôÔ∏è CONFIGURATION ET ENVIRONNEMENT</h2>

<h3>Variables d'environnement requises</h3>

<p>Fichiers : <code>.env.dev</code>, <code>.env.test</code>, <code>.env.prod</code></p>

<pre># Polaris ERP
ERP_URL=https://nur8.pl-vtest2-1221.polarisgestionmag.net:13543/api/WebConnect
ERP_API_KEY=votre_api_key_polaris

# Shopify
SHOPIFY_STORE_DOMAIN=votre-store.myshopify.com
SHOPIFY_ACCESS_TOKEN=shpat_xxxxxxxxxxxxxxxxxxxxxxxx
SHOPIFY_WEBHOOK_SECRET=whsec_xxxxxxxxxxxxxxxxxxxxxxxx

# PostgreSQL
PGUSER=postgres
PGHOST=localhost
PGDATABASE=owlblack_connector
PGPASSWORD=votre_mot_de_passe
PGPORT=5432</pre>

<h3>Scripts NPM disponibles</h3>

<pre># Serveur API
npm run prod              # Production
npm run test              # Test
npm run dev               # Development (nodemon)

# Synchronisation produits
npm run sync-products-prod
npm run sync-products-test
npm run sync-products-dev

# Gestion base de donn√©es
npm run init-db-prod      # Cr√©er tables
npm run update-db-prod    # Migrations
npm run delete-all-db-prod # Supprimer tables (DANGER)</pre>

<h3>D√©pendances principales</h3>

<table>
    <thead>
        <tr>
            <th>Package</th>
            <th>Version</th>
            <th>Usage</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>@shopify/shopify-api</td>
            <td>^11.11.1</td>
            <td>SDK Shopify officiel</td>
        </tr>
        <tr>
            <td>axios</td>
            <td>^1.8.4</td>
            <td>Client HTTP pour ERP</td>
        </tr>
        <tr>
            <td>express</td>
            <td>^4.21.2</td>
            <td>Serveur API</td>
        </tr>
        <tr>
            <td>pg</td>
            <td>^8.14.1</td>
            <td>Driver PostgreSQL</td>
        </tr>
        <tr>
            <td>dotenv</td>
            <td>^16.4.7</td>
            <td>Variables d'environnement</td>
        </tr>
        <tr>
            <td>crypto</td>
            <td>^1.0.1</td>
            <td>V√©rification HMAC webhooks</td>
        </tr>
    </tbody>
</table>

<div class="page-break"></div>

<h2>üéì CONCEPTS CL√âS POUR SHOPIFY + CHAUSSURES</h2>

<h3>Gestion des variantes chaussures</h3>

<p>L'application est <strong>parfaitement adapt√©e aux chaussures</strong> :</p>

<p><strong>Structure produit :</strong></p>
<pre>Produit : "Nike Air Max 2024"
‚îú‚îÄ‚îÄ Variante 1 : Taille 40 - Couleur Noir (SKU: NIKE-AIR-40-BLK)
‚îú‚îÄ‚îÄ Variante 2 : Taille 41 - Couleur Noir (SKU: NIKE-AIR-41-BLK)
‚îú‚îÄ‚îÄ Variante 3 : Taille 42 - Couleur Noir (SKU: NIKE-AIR-42-BLK)
‚îú‚îÄ‚îÄ Variante 4 : Taille 40 - Couleur Blanc (SKU: NIKE-AIR-40-WHT)
‚îî‚îÄ‚îÄ ...</pre>

<p><strong>Mapping Polaris ‚Üí Shopify :</strong></p>
<ul>
    <li><code>Tailles[].Taille</code> ‚Üí Option "Taille"</li>
    <li><code>Niveau1.Nom</code> ‚Üí Option "Couleur"</li>
    <li><code>Tailles[].Refs[0]</code> ‚Üí SKU unique</li>
</ul>

<h3>Gestion des stocks multi-magasins</h3>

<p><strong>Exemple :</strong></p>
<pre>SKU "NIKE-AIR-40-BLK" :
‚îú‚îÄ‚îÄ Magasin Paris (code 101) : 5 paires disponibles
‚îú‚îÄ‚îÄ Magasin Lyon (code 102) : 3 paires disponibles
‚îî‚îÄ‚îÄ Magasin Marseille (code 103) : 0 paires disponibles</pre>

<p><strong>Configuration Shopify requise :</strong></p>
<ol>
    <li>Cr√©er 3 locations dans Shopify (Paris, Lyon, Marseille)</li>
    <li>Ajouter metafield <code>code_magasin</code> √† chaque location :
        <ul>
            <li>Paris : <code>code_magasin = 101</code></li>
            <li>Lyon : <code>code_magasin = 102</code></li>
            <li>Marseille : <code>code_magasin = 103</code></li>
        </ul>
    </li>
</ol>

<h3>Gestion des prix</h3>

<ul>
    <li><strong>Prix TTC</strong> : <code>PrixTTC</code> ‚Üí <code>price</code></li>
    <li><strong>Prix barr√©</strong> : <code>PrixNormalTTC</code> ‚Üí <code>compareAtPrice</code></li>
    <li><strong>Promotions</strong> : Automatiquement affich√©es dans Shopify si <code>compareAtPrice > price</code></li>
</ul>

<div class="page-break"></div>

<h2>‚úÖ R√âPONSE AUX QUESTIONS DU CLIENT</h2>

<h3>1. Est-ce bien un connecteur Polaris ‚Üî Shopify ?</h3>

<div class="success">
    <p><strong>OUI, absolument.</strong></p>
    <ul>
        <li>‚úÖ Synchronise produits ERP Polaris ‚Üí Shopify</li>
        <li>‚úÖ Synchronise commandes Shopify ‚Üí ERP Polaris</li>
        <li>‚úÖ G√®re stocks multi-magasins</li>
        <li>‚úÖ G√®re prix et promotions</li>
    </ul>
</div>

<h3>2. Puis-je m'en servir pour recr√©er un connecteur pour mon client vendeur de chaussures ?</h3>

<div class="success">
    <p><strong>OUI, c'est parfaitement adapt√©.</strong></p>
</div>

<p><strong>Fonctionnalit√©s existantes r√©pondant au cahier des charges :</strong></p>

<table>
    <thead>
        <tr>
            <th>Besoin client</th>
            <th>Couverture</th>
            <th>Fichier</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>‚úÖ Import des produits dans Shopify</td>
            <td>100%</td>
            <td>/lib/syncLogic/products.js</td>
        </tr>
        <tr>
            <td>‚úÖ Import des prix dans Shopify</td>
            <td>100%</td>
            <td>/lib/syncLogic/products.js (price + compareAtPrice)</td>
        </tr>
        <tr>
            <td>‚úÖ Sortie de stock (commandes)</td>
            <td>100%</td>
            <td>/api/routes/shopify.js + /api/services/erpService.js</td>
        </tr>
        <tr>
            <td>‚ùå Retour produit</td>
            <td>0%</td>
            <td>√Ä d√©velopper</td>
        </tr>
    </tbody>
</table>

<p><strong>Ce qui fonctionne out-of-the-box :</strong></p>
<ul>
    <li>‚úÖ Gestion variantes chaussures (taille + couleur)</li>
    <li>‚úÖ Stocks multi-magasins</li>
    <li>‚úÖ Webhooks commandes temps r√©el</li>
    <li>‚úÖ D√©duplication commandes</li>
    <li>‚úÖ Prix promotionnels</li>
</ul>

<div class="warning">
    <p><strong>Ce qui n√©cessite adaptation :</strong></p>
    <ul>
        <li>‚ö†Ô∏è <strong>Retours produits</strong> : Non impl√©ment√©
            <ul>
                <li>Besoin d'un webhook <code>refunds/create</code> ou <code>returns/request</code></li>
                <li>Ajouter endpoint <code>/webhook/returns/create</code></li>
                <li>Cr√©er m√©thode <code>sendReturnToERP()</code> dans <code>erpService.js</code></li>
                <li>Mapper vers endpoint Polaris (ex: <code>/Ventes/Retour</code>)</li>
            </ul>
        </li>
        <li>‚ö†Ô∏è <strong>Configuration sp√©cifique client</strong> :
            <ul>
                <li>URL ERP Polaris du client</li>
                <li>API Key Polaris</li>
                <li>Credentials Shopify</li>
                <li>Codes magasins</li>
            </ul>
        </li>
    </ul>
</div>

<div class="page-break"></div>

<h2>üöÄ RECOMMANDATIONS POUR LE PROJET CLIENT</h2>

<h3>√âtapes de mise en place</h3>

<h4>Phase 1 : Configuration (1-2 jours)</h4>
<ol>
    <li>Cloner ce repository</li>
    <li>Configurer variables d'environnement :
        <ul>
            <li>URL API Polaris client</li>
            <li>API Key Polaris</li>
            <li>Credentials Shopify</li>
        </ul>
    </li>
    <li>Configurer PostgreSQL</li>
    <li>Initialiser BDD : <code>npm run init-db-prod</code></li>
    <li>D√©ployer sur VPS</li>
</ol>

<h4>Phase 2 : Configuration Shopify (1 jour)</h4>
<ol>
    <li>Cr√©er locations pour les magasins</li>
    <li>Ajouter metafields <code>code_magasin</code> sur chaque location</li>
    <li>Configurer webhooks :
        <ul>
            <li><code>orders/create</code> ‚Üí <code>https://{VPS}/webhook/orders/create</code></li>
            <li><code>products/delete</code> ‚Üí <code>https://{VPS}/webhook/products/delete</code></li>
        </ul>
    </li>
    <li>G√©n√©rer Access Token avec scopes :
        <ul>
            <li><code>read_products</code>, <code>write_products</code></li>
            <li><code>read_orders</code>, <code>write_orders</code></li>
            <li><code>read_inventory</code>, <code>write_inventory</code></li>
            <li><code>read_locations</code></li>
        </ul>
    </li>
</ol>

<h4>Phase 3 : Test synchronisation produits (2-3 jours)</h4>
<ol>
    <li>Lancer sync test : <code>npm run sync-products-test</code></li>
    <li>V√©rifier import en BDD</li>
    <li>V√©rifier cr√©ation produits Shopify</li>
    <li>V√©rifier stocks multi-locations</li>
    <li>Ajuster mapping si n√©cessaire</li>
</ol>

<h4>Phase 4 : Test commandes (2 jours)</h4>
<ol>
    <li>Passer commande test sur Shopify</li>
    <li>V√©rifier webhook re√ßu</li>
    <li>V√©rifier envoi vers Polaris</li>
    <li>V√©rifier cr√©ation commande dans ERP</li>
</ol>

<h4>Phase 5 : D√©veloppement retours (3-5 jours) ‚ö†Ô∏è √Ä d√©velopper</h4>
<ol>
    <li>Analyser documentation Polaris pour endpoint retours</li>
    <li>Cr√©er webhook <code>refunds/create</code></li>
    <li>D√©velopper <code>sendRefundToERP()</code></li>
    <li>Tester flux retour</li>
</ol>

<h4>Phase 6 : Mise en production (1 jour)</h4>
<ol>
    <li>Configuration SSL/HTTPS sur VPS</li>
    <li>Configuration PM2</li>
    <li>Tests charge</li>
    <li>Go live</li>
</ol>

<p><strong>Dur√©e totale estim√©e : 10-15 jours de d√©veloppement</strong></p>

<h3>Estimation budg√©taire</h3>

<table>
    <thead>
        <tr>
            <th>Poste</th>
            <th>D√©tail</th>
            <th>Dur√©e/Co√ªt</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><strong>D√©veloppement</strong></td>
            <td>Configuration + d√©ploiement</td>
            <td>2-3 jours</td>
        </tr>
        <tr>
            <td></td>
            <td>Tests + ajustements</td>
            <td>3-4 jours</td>
        </tr>
        <tr>
            <td></td>
            <td>D√©veloppement retours</td>
            <td>3-5 jours</td>
        </tr>
        <tr>
            <td></td>
            <td><strong>TOTAL</strong></td>
            <td><strong>8-12 jours</strong></td>
        </tr>
        <tr>
            <td><strong>Infrastructure mensuelle</strong></td>
            <td>VPS (2 CPU, 4GB RAM)</td>
            <td>20-40‚Ç¨/mois</td>
        </tr>
        <tr>
            <td></td>
            <td>PostgreSQL</td>
            <td>Inclus dans VPS</td>
        </tr>
        <tr>
            <td></td>
            <td>Shopify</td>
            <td>Plan client existant</td>
        </tr>
        <tr>
            <td></td>
            <td><strong>TOTAL</strong></td>
            <td><strong>20-40‚Ç¨/mois</strong></td>
        </tr>
    </tbody>
</table>

<div class="page-break"></div>

<h2>üîç CONCLUSION</h2>

<div class="info">
    <p><strong>Ce connecteur est un excellent point de d√©part</strong> pour le projet client vendeur de chaussures.</p>

    <p><strong>Couverture du cahier des charges :</strong></p>
    <ul>
        <li>‚úÖ Import produits : 100%</li>
        <li>‚úÖ Import prix : 100%</li>
        <li>‚úÖ Sortie de stock (commandes) : 100%</li>
        <li>‚ùå Retours produits : 0% (√† d√©velopper)</li>
    </ul>

    <p><strong>R√©utilisabilit√© : 80-90%</strong></p>

    <p>Le code n√©cessite principalement :</p>
    <ol>
        <li>Configuration des credentials</li>
        <li>D√©veloppement du module retours</li>
        <li>Tests avec les donn√©es client</li>
        <li>D√©ploiement sur VPS</li>
    </ol>

    <p><strong>Gain de temps estim√© : 70-80%</strong> par rapport √† un d√©veloppement from scratch.</p>
</div>

<h2>üìä M√âTRIQUES DE QUALIT√â DU CODE</h2>

<div class="success">
    <p><strong>Points forts :</strong></p>
    <ul>
        <li>‚úÖ Architecture claire et modulaire</li>
        <li>‚úÖ S√©paration responsabilit√©s (API / Sync / DB)</li>
        <li>‚úÖ Gestion transactions SQL</li>
        <li>‚úÖ D√©duplication commandes</li>
        <li>‚úÖ Throttling API g√©r√©</li>
        <li>‚úÖ D√©tection changements produits</li>
        <li>‚úÖ CI/CD automatis√©</li>
    </ul>
</div>

<div class="warning">
    <p><strong>Points d'am√©lioration :</strong></p>
    <ul>
        <li>‚ö†Ô∏è Pas de gestion d'erreurs centralis√©e</li>
        <li>‚ö†Ô∏è Logs basiques (console.log)</li>
        <li>‚ö†Ô∏è Pas de tests unitaires</li>
        <li>‚ö†Ô∏è Pas de monitoring/alerting</li>
        <li>‚ö†Ô∏è Retours non impl√©ment√©s</li>
        <li>‚ö†Ô∏è Synchronisation clients non impl√©ment√©e</li>
    </ul>
</div>

</body>
</html>
